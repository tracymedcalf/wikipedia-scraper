#!/usr/bin/env python
# coding: utf-8

from bs4 import BeautifulSoup
from urllib.request import urlopen

# Citation: https://stackoverflow.com/questions/13074586/extracting-selected-columns-from-a-table-using-beautifulsoup
def get_urls():
    url = "https://en.wikipedia.org/wiki/List_of_S%26P_500_companies"
    soup = BeautifulSoup(urlopen(url).read())
    soup.findAll('table')
    url_list = []
    for row in soup.findAll('table')[0].tbody.findAll('tr')[1:]:
        third_column = row.findAll('td')[1].contents # Security column
        url_list.append(third_column[0].get('href'))
    return url_list

def get_infobox(url):
    soup = BeautifulSoup(urlopen(url).read(),'lxml')
    return soup.find('table',class_='infobox vcard')

def get_text(start,html):
    return html.find("th", text=start).find_next_sibling().text

def get_inputter(file):
    def write_func(*inputs):
        for i in inputs:
            file.write(i)
    return write_func

def file_name(url):
    return str(url.split('/')[-1]) + '.data'

def get_money(text):
    my_list=text.split('$')[1].split()
    lowered = my_list[1].lower()
    if 'million' in lowered :
        conversion = 1000000
    elif 'billion' in lowered :
        conversion = 1000000000
    else:
        raise Exception('million or billion not in text')
    return float(my_list[0]) * conversion

# url_list = get_urls()
url_list = ['/wiki/3M', '/wiki/Abbott_Laboratories', '/wiki/AbbVie_Inc.', '/wiki/Abiomed', '/wiki/Accenture_plc', '/wiki/Activision_Blizzard', '/wiki/Adobe_Systems_Inc', '/wiki/Advanced_Micro_Devices_Inc', '/wiki/Advance_Auto_Parts', '/wiki/AES_Corp', '/wiki/Aetna_Inc', '/wiki/Affiliated_Managers_Group_Inc', '/wiki/AFLAC_Inc', '/wiki/Agilent_Technologies_Inc', '/wiki/Air_Products_%26_Chemicals_Inc', '/wiki/Akamai_Technologies_Inc', '/wiki/Alaska_Air_Group_Inc', '/wiki/Albemarle_Corp', '/wiki/Alexandria_Real_Estate_Equities', '/wiki/Alexion_Pharmaceuticals', '/wiki/Align_Technology', '/wiki/Allegion', '/wiki/Allergan,_Plc', '/wiki/Alliance_Data_Systems', '/wiki/Alliant_Energy_Corp', '/wiki/Allstate_Corp', '/wiki/Alphabet_Inc.', '/wiki/Alphabet_Inc.', '/wiki/Altria_Group_Inc', '/wiki/Amazon.com_Inc.', '/wiki/Ameren_Corp', '/wiki/American_Airlines_Group', '/wiki/American_Electric_Power', '/wiki/American_Express_Co', '/wiki/American_International_Group', '/wiki/American_Tower_Corp.', '/wiki/American_Water_Works', '/wiki/Ameriprise_Financial', '/wiki/AmerisourceBergen_Corp', '/wiki/AMETEK_Inc.', '/wiki/Amgen_Inc.', '/wiki/Amphenol_Corp', '/wiki/Anadarko_Petroleum_Corp', '/wiki/Analog_Devices,_Inc.', '/wiki/ANSYS', '/wiki/Anthem_Inc.', '/wiki/Aon_plc', '/wiki/A.O._Smith', '/wiki/Apache_Corporation', '/wiki/Apartment_Investment_%26_Management', '/wiki/Apple_Inc.', '/wiki/Applied_Materials_Inc.', '/wiki/Aptiv_Plc', '/wiki/Archer-Daniels-Midland_Co', '/wiki/Arconic_Inc.', '/wiki/Arista_Networks', '/wiki/Arthur_J._Gallagher_%26_Co.', '/wiki/Assurant', '/wiki/AT%26T_Inc.', '/wiki/Autodesk_Inc.', '/wiki/Automatic_Data_Processing', '/wiki/AutoZone_Inc', '/wiki/AvalonBay_Communities,_Inc.', '/wiki/Avery_Dennison_Corp', '/wiki/Baker_Hughes,_a_GE_Company', '/wiki/Ball_Corp', '/wiki/Bank_of_America_Corp', '/wiki/The_Bank_of_New_York_Mellon_Corp.', '/wiki/Baxter_International_Inc.', '/wiki/BB%26T_Corporation', '/wiki/Becton_Dickinson', '/wiki/Berkshire_Hathaway', '/wiki/Best_Buy_Co._Inc.', '/wiki/Biogen_Inc.', '/wiki/BlackRock', '/wiki/Block_H%26R', '/wiki/Boeing_Company', '/wiki/Booking_Holdings', '/wiki/BorgWarner', '/wiki/Boston_Properties', '/wiki/Boston_Scientific', '/wiki/Brighthouse_Financial_Inc', '/wiki/Bristol-Myers_Squibb', '/wiki/Broadcom_Limited', '/wiki/Broadridge_Financial_Solutions', '/wiki/Brown-Forman_Corp.', '/wiki/C._H._Robinson_Worldwide', '/wiki/Cabot_Oil_%26_Gas', '/wiki/Cadence_Design_Systems', '/wiki/Campbell_Soup', '/wiki/Capital_One_Financial', '/wiki/Cardinal_Health', '/wiki/Carmax_Inc', '/wiki/Carnival_Corp.', '/wiki/Caterpillar_Inc.', '/wiki/Cboe_Global_Markets', '/wiki/CBRE_Group', '/wiki/CBS_Corp.', '/wiki/Celgene_Corp.', '/wiki/Centene_Corporation', '/wiki/CenterPoint_Energy', '/wiki/CenturyLink_Inc', '/wiki/Cerner', '/wiki/CF_Industries_Holdings_Inc', '/wiki/Charles_Schwab_Corporation', '/wiki/Charter_Communications', '/wiki/Chevron_Corp.', '/wiki/Chipotle_Mexican_Grill', '/wiki/Chubb_Limited', '/wiki/Church_%26_Dwight', '/wiki/CIGNA_Corp.', '/wiki/Cimarex_Energy', '/wiki/Cincinnati_Financial', '/wiki/Cintas_Corporation', '/wiki/Cisco_Systems', '/wiki/Citigroup_Inc.', '/wiki/Citizens_Financial_Group', '/wiki/Citrix_Systems', '/wiki/The_Clorox_Company', '/wiki/CME_Group_Inc.', '/wiki/CMS_Energy', '/wiki/Coca-Cola_Company', '/wiki/Cognizant_Technology_Solutions', '/wiki/Colgate-Palmolive', '/wiki/Comcast_Corp.', '/wiki/Comerica_Inc.', '/wiki/Conagra_Brands', '/wiki/Concho_Resources', '/wiki/ConocoPhillips', '/wiki/Consolidated_Edison', '/wiki/Constellation_Brands', '/wiki/The_Cooper_Companies', '/wiki/Copart_Inc', '/wiki/Corning_Inc.', '/wiki/Costco_Wholesale_Corp.', '/wiki/Coty,_Inc', '/wiki/Crown_Castle_International_Corp.', '/wiki/CSX_Corp.', '/wiki/Cummins_Inc.', '/wiki/CVS_Health', '/wiki/D._R._Horton', '/wiki/Danaher_Corp.', '/wiki/Darden_Restaurants', '/wiki/DaVita', '/wiki/Deere_%26_Co.', '/wiki/Delta_Air_Lines', '/wiki/Dentsply_Sirona', '/wiki/Devon_Energy', '/wiki/Digital_Realty', '/wiki/Discover_Financial_Services', '/wiki/Discovery_Inc.', '/wiki/Discovery_Inc.', '/wiki/Dish_Network', '/wiki/Dollar_General', '/wiki/Dollar_Tree', '/wiki/Dominion_Energy', '/wiki/Dover_Corp.', '/wiki/DowDuPont', '/wiki/DTE_Energy', '/wiki/Duke_Realty', '/wiki/Duke_Energy', '/wiki/DXC_Technology', '/wiki/E*Trade', '/wiki/Eastman_Chemical', '/wiki/Eaton_Corporation', '/wiki/EBay', '/wiki/Ecolab', '/wiki/Edison_Int%27l', '/wiki/Edwards_Lifesciences', '/wiki/Electronic_Arts', '/wiki/Emerson_Electric_Company', '/wiki/Entergy_Corp.', '/wiki/EOG_Resources', '/wiki/Equifax_Inc.', '/wiki/Equinix', '/wiki/Equity_Residential', '/wiki/Essex_Property_Trust,_Inc.', '/wiki/Estee_Lauder_Cos.', '/wiki/Evergy', '/wiki/Eversource_Energy', '/wiki/Everest_Re', '/wiki/Exelon_Corp.', '/wiki/Expedia_Group', '/wiki/Expeditors_International', '/wiki/Express_Scripts', '/wiki/Extra_Space_Storage', '/wiki/Exxon_Mobil_Corp.', '/wiki/F5_Networks', '/wiki/Facebook,_Inc.', '/wiki/Fastenal_Co', '/wiki/Federal_Realty_Investment_Trust', '/wiki/FedEx_Corporation', '/wiki/Fidelity_National_Information_Services', '/wiki/Fifth_Third_Bancorp', '/wiki/FirstEnergy_Corp', '/wiki/Fiserv_Inc', '/wiki/Fleetcor', '/wiki/FLIR_Systems', '/wiki/Flowserve_Corporation', '/wiki/Fluor_Corp.', '/wiki/FMC_Corporation', '/wiki/Foot_Locker_Inc', '/wiki/Ford_Motor', '/wiki/Fortinet', '/wiki/Fortive_Corp', '/wiki/Fortune_Brands_Home_%26_Security', '/wiki/Franklin_Resources', '/wiki/Freeport-McMoRan_Inc.', '/wiki/Gap_Inc.', '/wiki/Garmin_Ltd.', '/wiki/Gartner', '/wiki/General_Dynamics', '/wiki/General_Electric', '/wiki/General_Mills', '/wiki/General_Motors', '/wiki/Genuine_Parts', '/wiki/Gilead_Sciences', '/wiki/Global_Payments_Inc.', '/wiki/Goldman_Sachs_Group', '/wiki/Goodyear_Tire_%26_Rubber', '/wiki/Grainger_(W.W.)_Inc.', '/wiki/Halliburton_Co.', '/wiki/Hanesbrands_Inc', '/wiki/Harley-Davidson', '/wiki/Harris_Corporation', '/wiki/Hartford_Financial_Svc.Gp.', '/wiki/Hasbro_Inc.', '/wiki/HCA_Holdings', '/wiki/HCP_Inc.', '/wiki/Helmerich_%26_Payne', '/wiki/Henry_Schein', '/wiki/The_Hershey_Company', '/wiki/Hess_Corporation', '/wiki/Hewlett_Packard_Enterprise', '/wiki/Hilton_Worldwide', '/wiki/HollyFrontier', '/wiki/Hologic', '/wiki/Home_Depot', '/wiki/Honeywell_Int%27l_Inc.', '/wiki/Hormel_Foods_Corp.', '/wiki/Host_Hotels_%26_Resorts', '/wiki/HP_Inc.', '/wiki/Humana_Inc.', '/wiki/Huntington_Bancshares', '/wiki/Huntington_Ingalls_Industries', '/wiki/Idexx_Laboratories', '/wiki/IHS_Markit', '/wiki/Illinois_Tool_Works', '/wiki/Illumina_(company)', '/wiki/Ingersoll-Rand_PLC', '/wiki/Intel_Corp.', '/wiki/Intercontinental_Exchange', '/wiki/IBM', '/wiki/Incyte', '/wiki/International_Paper', '/wiki/Interpublic_Group', '/wiki/Intl_Flavors_%26_Fragrances', '/wiki/Intuit', '/wiki/Intuitive_Surgical_Inc.', '/wiki/Invesco_Ltd.', '/wiki/IPG_Photonics', '/wiki/IQVIA', '/wiki/Iron_Mountain_Incorporated', '/wiki/Jack_Henry_%26_Associates_Inc', '/wiki/Jacobs_Engineering_Group', '/wiki/J._B._Hunt_Transport_Services', '/wiki/Jefferies_Financial_Group', '/wiki/JM_Smucker', '/wiki/Johnson_%26_Johnson', '/wiki/Johnson_Controls', '/wiki/JPMorgan_Chase_%26_Co.', '/wiki/Juniper_Networks', '/wiki/Kansas_City_Southern_(company)', '/wiki/Kellogg_Co.', '/wiki/KeyCorp', '/wiki/Keysight_Technologies', '/wiki/Kimberly-Clark', '/wiki/Kimco_Realty', '/wiki/Kinder_Morgan', '/wiki/KLA-Tencor_Corp.', '/wiki/Kohl%27s', '/wiki/Kraft_Heinz', '/wiki/Kroger_Co.', '/wiki/L_Brands_Inc.', '/wiki/L-3_Communications_Holdings', '/wiki/Laboratory_Corp._of_America_Holding', '/wiki/Lam_Research', '/wiki/Leggett_%26_Platt', '/wiki/Lennar_Corp.', '/wiki/Lilly_(Eli)_%26_Co.', '/wiki/Lincoln_National', '/wiki/Linde_plc', '/wiki/LKQ_Corporation', '/wiki/Lockheed_Martin_Corp.', '/wiki/Loews_Corp.', '/wiki/Lowe%27s_Cos.', '/wiki/LyondellBasell', '/wiki/M%26T_Bank_Corp.', '/wiki/Macerich', '/wiki/Macy%27s_Inc.', '/wiki/Marathon_Oil_Corp.', '/wiki/Marathon_Petroleum', '/wiki/Marriott_Int%27l.', '/wiki/Marsh_%26_McLennan', '/wiki/Martin_Marietta_Materials', '/wiki/Masco_Corp.', '/wiki/Mastercard_Inc.', '/wiki/Mattel_Inc.', '/wiki/McCormick_%26_Co.', '/wiki/McDonald%27s_Corp.', '/wiki/McKesson_Corp.', '/wiki/Medtronic_plc', '/wiki/Merck_%26_Co.', '/wiki/MetLife_Inc.', '/wiki/Mettler_Toledo', '/wiki/MGM_Resorts_International', '/wiki/Michael_Kors_(brand)', '/wiki/Microchip_Technology', '/wiki/Micron_Technology', '/wiki/Microsoft_Corp.', '/wiki/Mid-America_Apartments', '/wiki/Mohawk_Industries', '/wiki/Molson_Coors_Brewing_Company', '/wiki/Mondelez_International', '/wiki/Monster_Beverage', '/wiki/Moody%27s_Corp', '/wiki/Morgan_Stanley', '/wiki/The_Mosaic_Company', '/wiki/Motorola_Solutions_Inc.', '/wiki/MSCI_Inc', '/wiki/Mylan_N.V.', '/wiki/Nasdaq,_Inc.', '/wiki/National_Oilwell_Varco_Inc.', '/wiki/Nektar_Therapeutics', '/wiki/NetApp', '/wiki/Netflix_Inc.', '/wiki/Newell_Brands', '/wiki/Newfield_Exploration_Co', '/wiki/Newmont_Mining_Corporation', '/wiki/News_Corp._Class_A', '/wiki/News_Corp._Class_B', '/wiki/NextEra_Energy', '/wiki/Nielsen_Holdings', '/wiki/Nike_(company)', '/wiki/NiSource_Inc.', '/wiki/Noble_Energy_Inc', '/wiki/Nordstrom', '/wiki/Norfolk_Southern_Corp.', '/wiki/Northern_Trust_Corp.', '/wiki/Northrop_Grumman_Corp.', '/wiki/Norwegian_Cruise_Line', '/wiki/NRG_Energy', '/wiki/Nucor_Corp.', '/wiki/Nvidia_Corporation', '/wiki/O%27Reilly_Automotive', '/wiki/Occidental_Petroleum', '/wiki/Omnicom_Group', '/wiki/ONEOK', '/wiki/Oracle_Corp.', '/wiki/PACCAR_Inc.', '/wiki/Packaging_Corporation_of_America', '/wiki/Parker-Hannifin', '/wiki/Paychex_Inc.', '/wiki/PayPal', '/wiki/Pentair', '/wiki/People%27s_United_Financial', '/wiki/PepsiCo_Inc.', '/wiki/PerkinElmer', '/wiki/Perrigo', '/wiki/Pfizer_Inc.', '/wiki/PG%26E_Corp.', '/wiki/Philip_Morris_International', '/wiki/Phillips_66', '/wiki/Pinnacle_West_Capital', '/wiki/Pioneer_Natural_Resources', '/wiki/PNC_Financial_Services', '/wiki/Polo_Ralph_Lauren_Corp.', '/wiki/PPG_Industries', '/wiki/PPL_Corp.', '/wiki/Principal_Financial_Group', '/wiki/Procter_%26_Gamble', '/wiki/Progressive_Corp.', '/wiki/Prologis', '/wiki/Prudential_Financial', '/wiki/Public_Serv._Enterprise_Inc.', '/wiki/Public_Storage', '/wiki/Pulte_Homes_Inc.', '/wiki/PVH_Corp.', '/wiki/Qorvo', '/wiki/Quanta_Services_Inc.', '/wiki/QUALCOMM_Inc.', '/wiki/Quest_Diagnostics', '/wiki/Raymond_James_Financial_Inc.', '/wiki/Raytheon_Co.', '/wiki/Realty_Income_Corporation', '/wiki/Red_Hat_Inc.', '/wiki/Regency_Centers_Corporation', '/wiki/Regeneron', '/wiki/Regions_Financial_Corp.', '/wiki/Republic_Services_Inc', '/wiki/ResMed', '/wiki/Robert_Half_International', '/wiki/Rockwell_Automation_Inc.', '/wiki/Rockwell_Collins', '/wiki/Rollins_Inc.', '/wiki/Roper_Technologies', '/wiki/Ross_Stores', '/wiki/Royal_Caribbean_Cruises_Ltd', '/wiki/Salesforce.com', '/wiki/SBA_Communications', '/wiki/SCANA_Corp', '/wiki/Schlumberger_Ltd.', '/wiki/Seagate_Technology', '/wiki/Sealed_Air_Corp.(New)', '/wiki/Sempra_Energy', '/wiki/Sherwin-Williams', '/wiki/Simon_Property_Group_Inc', '/wiki/Skyworks_Solutions', '/wiki/SL_Green_Realty', '/wiki/Snap-on', '/wiki/Southern_Co.', '/wiki/Southwest_Airlines', '/wiki/S%26P_Global,_Inc.', '/wiki/Stanley_Black_%26_Decker', '/wiki/Starbucks_Corp.', '/wiki/State_Street_Corp.', '/wiki/Stericycle_Inc', '/wiki/Stryker_Corp.', '/wiki/SunTrust_Banks', '/wiki/SVB_Financial', '/wiki/Symantec_Corp.', '/wiki/Synchrony_Financial', '/wiki/Synopsys_Inc.', '/wiki/Sysco_Corp.', '/wiki/T._Rowe_Price_Group', '/wiki/Take-Two_Interactive', '/wiki/Tapestry,_Inc.', '/wiki/Target_Corp.', '/wiki/TE_Connectivity', '/wiki/TechnipFMC', '/wiki/Texas_Instruments', '/wiki/Textron_Inc.', '/wiki/Thermo_Fisher_Scientific', '/wiki/Tiffany_%26_Co.', '/wiki/Twitter,_Inc.', '/wiki/TJX_Companies_Inc.', '/wiki/Torchmark_Corp.', '/wiki/Total_System_Services', '/wiki/Tractor_Supply_Company', '/wiki/TransDigm_Group', '/wiki/The_Travelers_Companies_Inc.', '/wiki/TripAdvisor', '/wiki/Twenty-First_Century_Fox_Class_A', '/wiki/Twenty-First_Century_Fox_Class_B', '/wiki/Tyson_Foods', '/wiki/UDR_Inc', '/wiki/Ulta_Beauty', '/wiki/U.S._Bancorp', '/wiki/Under_Armour', '/wiki/Under_Armour', '/wiki/Union_Pacific', '/wiki/United_Continental_Holdings', '/wiki/United_Health_Group_Inc.', '/wiki/United_Parcel_Service', '/wiki/United_Rentals,_Inc.', '/wiki/United_Technologies', '/wiki/Universal_Health_Services,_Inc.', '/wiki/Unum_Group', '/wiki/V.F._Corp.', '/wiki/Valero_Energy', '/wiki/Varian_Medical_Systems', '/wiki/Ventas_Inc', '/wiki/Verisign_Inc.', '/wiki/Verisk_Analytics', '/wiki/Verizon_Communications', '/wiki/Vertex_Pharmaceuticals_Inc', '/wiki/Viacom_Inc.', '/wiki/Visa_Inc.', '/wiki/Vornado_Realty_Trust', '/wiki/Vulcan_Materials', '/wiki/Walmart', '/wiki/Walgreens_Boots_Alliance', '/wiki/The_Walt_Disney_Company', '/wiki/Waste_Management_Inc.', '/wiki/Waters_Corporation', '/wiki/Wec_Energy_Group_Inc', '/wiki/WellCare', '/wiki/Wells_Fargo', '/wiki/Welltower_Inc.', '/wiki/Western_Digital', '/wiki/Western_Union_Co', '/wiki/WestRock', '/wiki/Weyerhaeuser', '/wiki/Whirlpool_Corp.', '/wiki/Williams_Cos.', '/wiki/Willis_Towers_Watson', '/wiki/Wynn_Resorts', '/wiki/Xcel_Energy_Inc', '/wiki/Xerox', '/wiki/Xilinx', '/wiki/Xylem_Inc.', '/wiki/Yum!_Brands_Inc', '/wiki/Zimmer_Holdings', '/wiki/Zions_Bancorp', '/wiki/Zoetis']
def format_input(revenue,net_income,total_assets):
    return 'ticker\n#\n' + str(revenue / total_assets) + '\n#\n' + str(revenue / net_income) + '\n#\n'

# companies our script could not attain some piece of information for
comps_unattained = []

for url in url_list:
    try :
        box = get_infobox('https://en.wikipedia.org/' + url)
        revenue = get_money(get_text('Revenue',box))
        net_income = get_money(get_text('Net income',box))
        total_assets = get_money(get_text('Total assets',box))
        print(url, revenue,net_income,total_assets)
        file = open(file_name(url), 'a+')
        my_write = get_inputter(file)
        my_write(format_input(revenue,net_income,total_assets))
        file.close()
    except :
        comps_unattained.append(url)

print('\n'.join(comps_unattained))
